#!/usr/bin/env python
# coding:utf-8

import getopt,sys
from modules.SQLI_TEST import *
from modules.XSS_TEST import *
from modules.DOWNLOAD_TEST import *
from modules.UPLOAD_EXT_TEST import *
from modules.UPLOAD_CONTENT_TEST import *

def printSyntax():
	print '''
#=====================================
#-t type : test type (eg:sqli,xss,commandi,lfi,upload_ext,upload_content,download,spider)
#-m method: test method (eg:get,post)
#-d domain : test domain (eg:http://www.xxx.com/)
#-u usecase : test usecase 
#Usage:
	./exploit.py -t <type> -m <method> -d <domain> [-u <usecase>]
	./exploit.py -t sqli -m get -d http://www.xxoo.com -u usecase/sqli.usecase
#=====================================
'''

if __name__=='__main__':
	if len(sys.argv) < 7:
		printSyntax()
		sys.exit(1)
	else:
		try:
			opts,args = getopt.getopt(sys.argv[1:],"t:m:d:u:")
		except:
			printSyntax()
			sys.exit(1)

	type = None
	method = None
	domain = None
	usecase = None
	
	for opt,arg in opts:
		if opt == '-t':
			type = arg
		elif opt == '-m':
			method = arg
		elif opt == '-d':
			domain = arg
		elif opt == '-u':
			usecase = arg
		else:
			print "Unknown options!"
			printSyntax()
			sys.exit(1)

	if method != "get" and method != "post":
		print "Unknown method!"
		printSyntax()
		sys.exit(1)

	if type == "sqli":
		if usecase == None:
			usecase = "usecase/sqli.usecase"
		SQLI_TEST(domain,method,usecase)
	elif type == "xss":
		if usecase == None:
			usecase = "usecase/xss.usecase"
		XSS_TEST(domain,method,usecase)
	elif type == "lfi":
		if usecase == None:
			usecase = "usecase/lfi.usecase"
		LFI_TEST(domain,method,usecase)
	elif type == "commandi":
		if usecase == None:
			usecase = "usecase/commandi.usecase"
		COMMANDI_TEST(domain,method,usecase)
	elif type =="download":
		if usecase == None:
			usecase = "usecase/download.usecase"
		if method == "post":
			print "download method must be GET!"
			printSyntax()
			sys.exit(1)
		DOWNLOAD_TEST(domain,method,usecase)
	elif type == "upload_ext":
		if usecase == None:
			usecase = "usecase/upload_ext.usecase"
		if method == "get":
			print "upload method must be POST!"
			printSyntax()
			sys.exit(1)
		UPLOAD_EXT_TEST(domain,method,usecase)
	elif type == "upload_content":
		if usecase == None:
                        usecase = "usecase/upload_content"
                if method == "get":
                        print "upload method must be POST!"
                        printSyntax()
                        sys.exit(1)
                UPLOAD_CONTENT_TEST(domain,method,usecase)
	elif type == "spider":
		if usecase == None:
			usecase = "usecase/spider.usecase"
		SPIDER_TEST(domain,method,usecase)
	else:
		print "Unknown type!"
